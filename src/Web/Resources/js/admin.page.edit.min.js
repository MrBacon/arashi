$(function(){$("#post-edit-tags a").button();$("#post-edit-publish").click(function(){showPostEditMenu($("#post-edit-publish"),$("#menu-publish"))});$("#post-edit-customfields").click(function(){showPostEditMenu($("#post-edit-customfields"),$("#menu-customfields"))});$("#post-edit-customtemplatefile").click(function(){showPostEditMenu($("#post-edit-customtemplatefile"),$("#menu-customtemplatefile"))});$("#post-edit-parentpage").click(function(){showPostEditMenu($("#post-edit-parentpage"),$("#menu-parentpage"))});$("#addNewCustomFieldLink").click(function(){$("#newCustomFieldPanel").slideToggle()});$("#submitNewCustomFieldLink").click(function(){postNewCustomField()});$("#post-permalink-edit").click(function(){$(this).hide();$("#post-permalink-edit-container").fadeIn()});$("#post-permalink-edit-cancel").click(function(){$("#post-permalink-edit-container").fadeOut();$("#post-permalink-edit").show()});$("#post-permalink-edit-submit").click(function(){postPermalinkUpdate()});$("#table-customfields").jqGrid({url:urlGetCustomFields,editurl:urlUpdateCustomFields,width:340,height:"auto",shrinkToFit:true,datatype:"json",mtype:"POST",colNames:["Key","Value",""],colModel:[{name:"key",fixed:true,key:true,align:"left",width:"100",editable:false,sortable:false,resizable:false},{name:"value",fixed:true,align:"left",editable:true,sortable:false,resizable:false},{name:"action",fixed:true,align:"center",width:"40",editable:false,sortable:false,resizable:false}],onSelectRow:function(A){if(A&&A!==lastsel){jQuery("#table-customfields").restoreRow(lastsel);jQuery("#table-customfields").editRow(A,true,null,function(B){growl("Custom field saved!",false,false);return true},null,null,null,function(C,B){growl("Sorry, an error occured!",true,false)});lastsel=A}},gridComplete:function(){var B=jQuery("#table-customfields").jqGrid("getDataIDs");for(var A=0;A<B.length;A++){html="<button type='button' class='table-customfields-deletebutton' title='Delete this custom field' ><img src='/Resources/img/16x16/cross_circle_frame.png' alt='' /></button>";jQuery("#table-customfields").jqGrid("setRowData",B[A],{action:html})}$("#table-customfields button.table-customfields-deletebutton").click(function(){var C=jQuery("#table-customfields").jqGrid("getGridParam","selrow");if(C!=null){jQuery("#table-customfields").jqGrid("delGridRow",C,{reloadAfterSubmit:false})}})}})});function showPostEditMenu(B,A){if(A.is(":hidden")){A.css({top:0,left:0});A.position({my:"left top",at:"left bottom",of:B,offset:"0 0"});A.show();B.removeClass("ui-corner-all");B.addClass("ui-corner-top");A.removeClass("ui-corner-all");A.addClass("ui-corner-bottom");A.addClass("ui-corner-tr")}else{A.hide();B.removeClass("ui-corner-top");B.addClass("ui-corner-all");A.removeClass("ui-corner-bottom");A.removeClass("ui-corner-tr");A.addClass("ui-corner-all")}}function postPermalinkUpdate(){$.post(urlUpdatePermalink,{permalink:$("#FriendlyName").val(),id:$("#post-permalink-edit-submit").attr("rel")},function(A){showMessage(A);$("#post-permalink-edit-container").fadeOut();$("#post-permalink-edit").show()})}function postNewCustomField(){var A=$("#customfield-form input#Key").val();var B=$("#customfield-form textarea#Value").val();if(_isNull(A)||_isNull(B)){growl("To add a new custom field you must specify the key and the value!",true,true);return false}$.post(urlSaveNewCustomField,{contentitemid:$("#contentitemid").val(),key:A,value:B},function(C){showMessage(C);$("#customfield-form input#Key").val("");$("#customfield-form textarea#Value").val("");$("#table-customfields").trigger("reloadGrid")})};