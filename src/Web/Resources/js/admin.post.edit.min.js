$(function(){$("#post-edit-tags a").button();$("#post-edit-publish").click(function(){showPostEditMenu($("#post-edit-publish"),$("#menu-publish"))});$("#post-edit-tags").click(function(){showPostEditMenu($("#post-edit-tags"),$("#menu-tags"))});$("#post-edit-categories").click(function(){showPostEditMenu($("#post-edit-categories"),$("#menu-categories"))});$("#post-edit-customfields").click(function(){showPostEditMenu($("#post-edit-customfields"),$("#menu-customfields"))});$("#post-permalink-edit").click(function(){$(this).hide();$("#post-permalink-edit-container").fadeIn()});$("#post-permalink-edit-cancel").click(function(){$("#post-permalink-edit-container").fadeOut();$("#post-permalink-edit").show()});$("#post-permalink-edit-submit").click(function(){postPermalinkUpdate()});$("#showSummaryLink").click(function(){$(this).hide();$("#summaryFieldset").slideToggle()});$("#addNewCategoryLink").click(function(){$("#newCategoryPanel").slideToggle()});$("#submitNewTagLink").click(function(){postNewTag()});$("#addNewCustomFieldLink").click(function(){$("#newCustomFieldPanel").slideToggle()});$("#submitNewCustomFieldLink").click(function(){postNewCustomField()});$("#submitNewCategoryLink").click(function(){postNewCategory()});setTagCheckListEvents();$("#tab-tag-selection").tabs();$("#tab-tag-selection").removeClass("ui-widget");$("#all-tags-select").change(function(){var A=$("option:selected",this);if(A.val()!=""){addTagToPost(A.val(),A.text());$(this).val(0)}});getTagCloud();$("#table-customfields").jqGrid({url:urlGetCustomFields,editurl:urlUpdateCustomFields,width:340,height:"auto",shrinkToFit:true,datatype:"json",mtype:"POST",colNames:["Key","Value",""],colModel:[{name:"key",fixed:true,key:true,align:"left",width:"100",editable:false,sortable:false,resizable:false},{name:"value",fixed:true,align:"left",editable:true,sortable:false,resizable:false},{name:"action",fixed:true,align:"center",width:"40",editable:false,sortable:false,resizable:false}],onSelectRow:function(A){if(A&&A!==lastsel){jQuery("#table-customfields").restoreRow(lastsel);jQuery("#table-customfields").editRow(A,true,null,function(B){growl("Custom field saved!",false,false);return true},null,null,null,function(C,B){growl("Sorry, an error occured!",true,false)});lastsel=A}},gridComplete:function(){var B=jQuery("#table-customfields").jqGrid("getDataIDs");for(var A=0;A<B.length;A++){html="<button type='button' class='table-customfields-deletebutton' title='Delete this custom field' ><img src='/Resources/img/16x16/cross_circle_frame.png' alt='' /></button>";jQuery("#table-customfields").jqGrid("setRowData",B[A],{action:html})}$("#table-customfields button.table-customfields-deletebutton").click(function(){var C=jQuery("#table-customfields").jqGrid("getGridParam","selrow");if(C!=null){jQuery("#table-customfields").jqGrid("delGridRow",C,{reloadAfterSubmit:false})}})}})});function showPostEditMenu(B,A){if(A.is(":hidden")){A.css({top:0,left:0});A.position({my:"left top",at:"left bottom",of:B,offset:"0 0"});A.show();B.removeClass("ui-corner-all");B.addClass("ui-corner-top");A.removeClass("ui-corner-all");A.addClass("ui-corner-bottom");A.addClass("ui-corner-tr")}else{A.hide();B.removeClass("ui-corner-top");B.addClass("ui-corner-all");A.removeClass("ui-corner-bottom");A.removeClass("ui-corner-tr");A.addClass("ui-corner-all")}}function postNewTag(){var A=$("#newtagform input#TagName").val();$.post(urlSaveNewTag,{Name:A},function(B){showMessage(B);$("#newtagform input#TagName").val("");getTagCloud();$.get(urlGetTagId,{name:A},function(C){if(C!=""){addTagToPost(C,A)}})})}function postNewCategory(){var A=$("#newcategoryform input#CategoryName").val();var B=$("#newcategoryform select#ParentCategory").val();if(_isNull(A)){growl("To add a new category you must specify the name!",true,true);return false}$.post(urlSaveNewCategory,{Name:A,parentCategoryId:B},function(C){showMessage(C);$("#newcategoryform input#CategoryName").val("");$("#newcategoryform select#ParentCategory").val("")})}function postNewCustomField(){var A=$("#customfield-form input#Key").val();var B=$("#customfield-form textarea#Value").val();if(_isNull(A)||_isNull(B)){growl("To add a new custom field you must specify the key and the value!",true,true);return false}$.post(urlSaveNewCustomField,{contentitemid:$("#contentitemid").val(),key:A,value:B},function(C){showMessage(C);$("#customfield-form input#Key").val("");$("#customfield-form textarea#Value").val("");$("#table-customfields").trigger("reloadGrid")})}function addTagToPost(D,E){if($("#tagchecklist").find("li .tag input[value="+D+"]").length>0){return }var C="tagid-"+D;var G=$("<li></li>");var F=$("<input type='hidden' id='"+C+"' name='tagid' value='"+D+"'/>");var B=$("<div class='tag'>"+E+"</div>");var A=$("<a class='tag-remove' href='#' title='Remove this tag'><span class='ui-icon ui-icon-circle-close'></span>remove</a>");B.append(F);G.append(B).append(A);$("#tagchecklist").append(G);$("#tagchecklist-empty").hide();setTagCheckListEvents()}function getTagCloud(){$.get(urlGetTagCloud,function(A){if(A!=""){$("#tabPopular").empty().append(A);$("#tabPopular a").unbind();$("#tabPopular a").click(function(){addTagToPost($(this).attr("rel"),$(this).text())})}})}function setTagCheckListEvents(){$("#tagchecklist li").unbind();$("#tagchecklist li").hover(function(){$("a.tag-remove",this).show()},function(){$("a.tag-remove",this).hide()});$("#tagchecklist li a.tag-remove").unbind();$("#tagchecklist li a.tag-remove").click(function(){$(this).parent().remove()})}function postPermalinkUpdate(){$.post(urlUpdatePermalink,{permalink:$("#FriendlyName").val(),id:$("#post-permalink-edit-submit").attr("rel")},function(A){showMessage(A);$("#post-permalink-edit-container").fadeOut();$("#post-permalink-edit").show()})};